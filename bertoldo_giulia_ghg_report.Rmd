---
title: "Global Greenhouse Gas (GHG) Emissions Report"
author: "Giulia Bertoldo"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
# Set up and variables 
knitr::opts_chunk$set(echo = TRUE)
path = 'data/EDGAR_2024_GHG_booklet_2024.xlsx'
# Load packages
library(tidyverse)
library(readxl)
library(purrr)
library(stringr)
```

# Introduction 
The report uses greenhouse gas (GHG) emissions time series data from the Emissions Database for Global Atmospheric Research (EDGAR). The database provides data covering all countries and spanning from 1970 to 2023. The report includes three charts providing insights to the questions:

1. What is the evolution of GHG growth in the euro area, in the European Union, and worldwide?

2. How do countries (classified as in the World Bank income groups) compare with respect to GHG emissions per capita?

3. What is the contribution of individual countries and continents to the worldwide GHG emissions?

# Process
Data have been cleaned, analyzed, and visualized using R, mainly through the tidyverse package (e.g., dplyr, ggplot). The report has been generated using RMarkdown. The workflow included working with RStudio, git and GitHub. 

# Evolution of GHG emission growth

What is the evolution of GHG growth in the euro area, in the European Union, and worldwide?

```{r include=FALSE}
# Read data
df_ghg_totals_by_country <- read_excel(path, sheet = 'GHG_totals_by_country')

# DATA QUALITY -------------------------------------------------------------------------------
#### Data types checks ####
glimpse(df_ghg_totals_by_country)

# `EDGAR Country Code`
df_ghg_totals_by_country$`EDGAR Country Code`
df_ghg_totals_by_country$Country

#### Upper case country name ####
df_ghg_totals_by_country <- df_ghg_totals_by_country %>%
  mutate (Country = str_to_upper(Country))

####  Missing values ####
as.data.frame(map(df_ghg_totals_by_country, ~sum(is.na(.))))

df_na <- df_ghg_totals_by_country %>%
  filter(if_any(everything(), is.na))

# Filter out two rows with missing values
df_ghg_totals_by_country <- df_ghg_totals_by_country %>%
  filter(if_all(everything(), ~ !is.na(.)))

####  Duplicates ####
duplicate_rows <- df_ghg_totals_by_country %>%
  duplicated(.) | duplicated(df_ghg_totals_by_country, fromLast = TRUE)
sum(duplicate_rows)

#### Factors####
# Convert character columns to factor
df_ghg_totals_by_country <- df_ghg_totals_by_country %>%
  mutate(across(where(is.character), factor))

#### EUROZONE FLAG, EU27 FLAG, GLOBAL FLAG ####
# eurozone 
eurozone <- c('AUSTRIA', 'BELGIUM', 'CROATIA', 'CYPRUS', 'ESTONIA', 'FINLAND',
              'FRANCE AND MONACO', 'GERMANY', 'GREECE', 'IRELAND',
              'ITALY, SAN MARINO AND THE HOLY SEE', 'LATVIA', 'LITHUANIA',
              'LUXEMBOURG', 'MALTA', 'NETHERLANDS', 'PORTUGAL', 'SLOVAKIA',
              'SLOVENIA', 'SPAIN AND ANDORRA')

# Keep only relevant rows
df_ghg_totals_by_country <- df_ghg_totals_by_country %>%
  filter((Country %in% c('EU27', 'GLOBAL TOTAL')) | (Country %in% eurozone))

df_ghg_totals_by_country <- df_ghg_totals_by_country %>%
  mutate(GEO_TYPE = case_when(
    Country == 'EU27' ~ 'EU27',
    Country == 'GLOBAL TOTAL' ~ 'GLOBAL',
    Country %in% eurozone ~ 'EUROZONE'
  ))

check_eurozone <- df_ghg_totals_by_country %>%
  select(Country, GEO_TYPE) 
print(check_eurozone, n = Inf )

#### Pivot longer ####
df_ghg_totals_by_country_long <- df_ghg_totals_by_country %>%
  pivot_longer(cols = `1970`: `2023`, names_to = 'YEAR', values_to = 'GHG_EMM')

glimpse(df_ghg_totals_by_country_long)

#### Select column ####
df_ghg_totals_by_country_long <- df_ghg_totals_by_country_long %>%
  select(GEO_TYPE, YEAR, GHG_EMM)

#### Aggregate ####
df_ghg_totals_by_country_group <- df_ghg_totals_by_country_long %>%
  group_by(GEO_TYPE, YEAR) %>%
  summarize(TOT_GHG_EMM = sum(GHG_EMM), .groups = "drop")

```

```{r echo = FALSE}
#### CHART 1 --------------------------------------------------
## Linechart with two lines
ggplot(df_ghg_totals_by_country_group, aes(x = YEAR, y = TOT_GHG_EMM, color = factor(GEO_TYPE), group = GEO_TYPE)) +
  geom_line() +
  labs(
    title = 'Evolution of GHG Emissions',
    x = 'Year',
    y = 'GHG (Mt CO2eq/yr)',
    color = 'Geography Type'
  ) +
  theme_light() +
  theme(
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
    legend.text = element_text(size = 8),          # Smaller text for legend items
    legend.title = element_text(size = 10),       # Smaller text for legend title
    legend.key.size = unit(0.3, "cm"),            # Reduce legend key size
    legend.spacing.y = unit(0.2, "cm")           # Adjust vertical spacing between items
) +
  scale_x_discrete(breaks = df_ghg_totals_by_country_group$YEAR[seq(1, length(df_ghg_totals_by_country_group$YEAR), by = 2)])  

```

# Contries GHG emission comparison

# Contribution of individual countires and continenetes to worlwide GHG emissions


# Reference  

EDGAR (Emissions Database for Global Atmospheric Research) Community GHG Database (a collaboration between the European Commission, Joint Research Centre (JRC), the International Energy Agency (IEA), and comprising IEA-EDGAR CO2, EDGAR CH4, EDGAR N2O, EDGAR F-GASES version EDGAR_2024_GHG (2024) European Commission.

European Commission, Joint Research Centre, Crippa, M., Guizzardi, D., Pagani, F., Banja, M., Muntean, M., Schaaf, E., Monforti-Ferrario, F., Becker, W.E., Quadrelli, R., Risquez Martin, A., Taghavi-Moharamli, P., Köykkä, J., Grassi, G., Rossi, S., Melo, J., Oom, D., Branco, A., San-Miguel, J., Manca, G., Pisoni, E., Vignati, E. and Pekar, F., GHG emissions of all world countries, Publications Office of the European Union, Luxembourg, 2024, https://data.europa.eu/doi/10.2760/4002897, JRC138862.

IEA-EDGAR CO2 (v3), a component of the EDGAR (Emissions Database for Global Atmospheric Research) Community GHG database version EDGAR_2024_GHG (2024) including or based on data from IEA (2023) Greenhouse Gas Emissions from Energy, www.iea.org/statistics, as modified by the Joint Research Centre.

Source data: https://edgar.jrc.ec.europa.eu/dataset_ghg2024

EDGAR_2024_GHG website: https://edgar.jrc.ec.europa.eu/dataset_ghg2024 



## R Markdown

Analysis from the Emissions Database for Global Atmosperic Research (EDGAR)


This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
